<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1 user-scalable=no" />
	<title>H5跳转APP</title>
	<script>
		$('a').click(function() {
    	var ifr = document.createElement('iframe');
    	ifr.src = 'com.xiangchao.StarZone';
    	ifr.style.display = 'none';
    	document.body.appendChild(ifr);
    	setTimeout(function(){
        	document.body.removeChild(ifr);
    		}, 3000);
		});

		function submitFn(){
    	//判断浏览器
        
	    var u = navigator.userAgent;
	    if(/MicroMessenger/gi.test(u)) {
	       // 引导用户在浏览器中打开
	        alert('请在浏览器中打开');
	        return;
	    }
	    var d = new Date();
	    var t0 = d.getTime();
	    if(u.indexOf('Android') > -1 || u.indexOf('Linux') > -1){
	        //Android
	        if(openApp('en51ccmpro://startapp')){
	         openApp('en51ccmpro://startapp');
	        }else{
	            //由于打开需要1～2秒，利用这个时间差来处理－－打开app后，返回h5页面会出现页面变成app下载页面，影响用户体验
	            var delay = setInterval(function(){
	                 var d = new Date();
	                 var t1 = d.getTime();
	                 if( t1-t0<3000 && t1-t0>2000){
	                    alert('请下载APP');
	                     window.location.href = "app下载地址";
	                 }
	                 if(t1-t0>=3000){
	                      clearInterval(delay);
	                 }
	            },1000);
	        }
	    }else if(u.indexOf('iPhone') > -1){
	        //IOS
	        if(openApp('com.xiangchao.StarZone')){  
	            openApp('com.xiangchao.StarZone');
	        }else{
	            var delay = setInterval(function(){
	                var d = new Date();
	                var t1 = d.getTime();
	                if( t1-t0<3000 && t1-t0>2000){
	                    alert('请下载APP');
	                    window.location.href = "app下载地址";
	                }
	                if(t1-t0>=3000){
	                    clearInterval(delay);
	                }
	            },1000);
	        }
	    }    
	}

	function openApp(src) {
	// 通过iframe的方式试图打开APP，如果能正常打开，会直接切换到APP，并自动阻止a标签的默认行为否则打开a标签的href链接 //  
	     var ifr = document.createElement('iframe');
	     ifr.src = src;
	     ifr.style.display = 'none';
	     document.body.appendChild(ifr);
	     window.setTimeout(function(){
	          document.body.removeChild(ifr);
	     },2000);
	}
	</script>

	

</head>
<body>
	<button onclick="submitFn">打开APP</button>
	<style>
		button1{
    		width:100px;
    		height:100px;
		}
	</style>
	<a href "https://itunes.apple.com/cn/app/%E6%98%8E%E6%98%9F%E7%A9%BA%E9%97%B4-%E7%B2%89%E4%B8%9D%E8%BF%BD%E6%98%9F%E7%A5%9E%E5%99%A8/id1064414689?mt=8" onclick="OpenAppWithLink">H5跳转APP</a> 
</body>
</html>
